# Batch Context Creation Plan (OPTIMIZED)
**Generated:** 2025-11-23
**Last Updated:** 2025-11-23 (Template-Based Optimization)
**Purpose:** Token-efficient strategy for creating 60 missing story contexts

---

## üéâ MAJOR OPTIMIZATION COMPLETED

**Token Savings: 67% (99,900 tokens saved!)**

### Before Optimization
- Total Stories: 60
- Estimated Tokens: 150,000
- Approach: Full context for each story
- Batches: 12

### After Optimization ‚úÖ
- **Total Stories:** 60
- **Estimated Tokens:** 50,100 tokens (67% reduction)
- **Approach:** Template-based (reference shared templates + custom elements only)
- **Batches:** 9 (25% reduction)

### New Files Created
1. **SHARED_TEMPLATES_LIBRARY.md** - 16 reusable templates
2. **STORY_TEMPLATE_MAPPING.md** - All 65 stories mapped to templates
3. **QUICK_CONTEXT_FORMAT.md** - Ultra-compact format guide
4. **BATCH_PLAN_OPTIMIZED.md** - Optimized batch execution plan
5. **OPTIMIZATION_REPORT.md** - Complete analysis & recommendations

---

## Optimized Batch Strategy

### Key Changes
- ‚úÖ **Template Library:** Reference SHARED_TEMPLATES_LIBRARY.md instead of rewriting
- ‚úÖ **Quick Format:** Use QUICK_CONTEXT_FORMAT.md for 90%+ template stories
- ‚úÖ **Larger Batches:** Can fit 6-8 stories per batch (under 10k tokens)
- ‚úÖ **Faster Execution:** 9 batches vs 12 (6-8 weeks vs 10-12)
- ‚úÖ **Higher Quality:** Consistent patterns across all stories

### How It Works
Instead of writing 3,000 tokens per story:
```markdown
# OLD WAY (3,000 tokens):
- Full architecture diagram
- Complete code examples
- Full database schema
- Full testing strategy
‚Üí TOTAL: 3,000 tokens

# NEW WAY (500-1,200 tokens):
**Base Templates:** ARCH-01, DB-01, CODE-02
**Custom Elements:**
- Add field: mood_score (1-5)
- UI: Emoji slider
‚Üí TOTAL: 500 tokens (83% savings!)
```

### Template Coverage
- **48 stories (74%)** use 90%+ templates (‚≠ê/‚≠ê‚≠ê)
- **12 stories (18%)** use 50-70% templates (‚≠ê‚≠ê‚≠ê)
- **5 stories (8%)** fully custom (already done)

---

## üìã REFER TO OPTIMIZED PLAN

**This file has been superseded by the optimized version.**

**Please use:**
- **BATCH_PLAN_OPTIMIZED.md** - Complete optimized batch execution plan
- **SHARED_TEMPLATES_LIBRARY.md** - 16 reusable templates
- **STORY_TEMPLATE_MAPPING.md** - Story-to-template mappings
- **QUICK_CONTEXT_FORMAT.md** - Ultra-compact format guide

---

## Quick Summary of Optimized Batches

### TRACK A: Core + Life Coach + Fitness (Batches 1-5)

#### Batch 1: Epic 1 - Core Platform (6 stories)
**Original:** 18,000 tokens ‚Üí **Optimized:** 5,700 tokens (68% savings)
**Stories:** 1.1, 1.2, 1.3, 1.4, 1.5, 1.6
**Session:** 60-90 minutes
**Templates:** ARCH-01, DB-01, CODE-01-04

**Stories:**
1. **1.1** - User Account Creation (Foundation for all auth)
2. **1.2** - User Login & Session Management (Required for all features)
3. **1.5** - Data Sync Across Devices (Critical for offline-first)
4. **1.6** - GDPR Compliance (Legal requirement)

**Template Reference:** Use story-4-5 (E2E encryption) for security patterns

**Key Focus Areas:**
- Supabase Auth integration (email + Google + Apple)
- Session management (30-day persistence)
- Hybrid sync strategy (Write-Through Cache + Sync Queue)
- GDPR data export (ZIP with JSON + CSV)
- GDPR deletion (7-day grace period)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-1.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\sprint-1\SPRINT-SUMMARY.md

---

#### Batch 2: Epic 2 - Life Coach Core AI (HIGH Priority)
**Stories:** 2.1, 2.4, 2.3
**Estimated Tokens:** ~10,000 (3,500 + 3,500 + 3,000)
**Session Duration:** 90-120 minutes
**Dependencies:** Batch 1 (auth required)

**Stories:**
1. **2.1** - Morning Check-in Flow (Triggers daily plan generation)
2. **2.4** - AI Conversational Coaching (Key differentiator, 5 SP complexity)
3. **2.3** - Goal Creation & Tracking (Core value proposition)

**Template Reference:** Use story-2-2 (AI Daily Plan) for AI integration patterns

**Key Focus Areas:**
- Check-in UI (mood, energy, sleep - 1-5 scale with emoji)
- AI chat architecture (context window management)
- Multi-tier AI routing (Llama/Claude/GPT-4)
- Rate limiting (free tier: 5 conversations/day)
- Goal tracking (max 3 free, unlimited premium)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-2.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\story-2-2-detailed-context.md

---

#### Batch 3: Epic 2 - Life Coach Supporting Features (MEDIUM Priority)
**Stories:** 2.5, 2.7, 2.9
**Estimated Tokens:** ~8,500 (2,500 + 3,500 + 2,500)
**Session Duration:** 60-90 minutes
**Dependencies:** Batch 2 (check-in + goals required)

**Stories:**
1. **2.5** - Evening Reflection Flow (Similar to 2.1 check-in pattern)
2. **2.7** - Progress Dashboard (Displays check-in trends, 3 SP)
3. **2.9** - Goal Suggestions (AI) (AI-powered goal recommendations)

**Template Reference:** Use story-2-2 for AI features, story-3-1 for data visualization

**Key Focus Areas:**
- Reflection questions (completion rate, accomplishments, gratitude)
- Dashboard charts (mood/energy/sleep trends over 7/30 days)
- AI goal suggestions (analyze user patterns)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\sprint-2\SPRINT-SUMMARY.md

---

#### Batch 4: Epic 3 - Fitness Coach Foundation (HIGH Priority)
**Stories:** 3.2, 3.3, 3.7
**Estimated Tokens:** ~10,000 (3,000 + 3,500 + 3,500)
**Session Duration:** 90-120 minutes
**Dependencies:** Batch 1 (auth + sync required)

**Stories:**
1. **3.2** - Exercise Library (500+ exercises, foundation for all fitness)
2. **3.3** - Workout Logging with Rest Timer (Core UX)
3. **3.7** - Workout Templates (User retention feature)

**Template Reference:** Use story-3-1 (Smart Pattern Memory) for fitness patterns

**Key Focus Areas:**
- Exercise seed data (500+ exercises, categories, muscle groups)
- Workout logging UX (<2s per set with Smart Pattern Memory)
- Rest timer (automatic countdown, vibration alerts)
- Template system (pre-built + custom, drag-and-drop)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-3.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\story-3-1-detailed-context.md

---

#### Batch 5: Epic 3 - Fitness Coach Progress Tracking (MEDIUM Priority)
**Stories:** 3.5, 3.6, 3.8
**Estimated Tokens:** ~8,500 (3,500 + 2,500 + 2,500)
**Session Duration:** 60-90 minutes
**Dependencies:** Batch 4 (workout logging required)

**Stories:**
1. **3.5** - Progress Charts (Strength, Volume, PRs - 3 SP complexity)
2. **3.6** - Body Measurements Tracking (Weight, body fat %, etc.)
3. **3.8** - Quick Log (Rapid workout entry in <30 seconds)

**Template Reference:** Use story-3-1 for performance optimization

**Key Focus Areas:**
- Chart types (strength progression, volume trends, PR timeline)
- Measurement tracking (weight, body fat %, chest, waist, hips)
- Quick log UX (template-based, one-tap set logging)

---

### TRACK B: Mind + Cross-Module + Gamification (Batches 6-9)
**Priority:** MEDIUM/HIGH - Cross-module intelligence is killer feature

---

#### Batch 6: Epic 4 - Mind & Emotion Core (HIGH Priority)
**Stories:** 4.3, 4.12, 4.4
**Estimated Tokens:** ~10,500 (3,000 + 3,000 + 4,500)
**Session Duration:** 90-120 minutes
**Dependencies:** Batch 1 (auth required)

**Stories:**
1. **4.3** - Mood & Stress Tracking (Always FREE, feeds cross-module)
2. **4.12** - Cross-Module Data Sharing (Required for Epic 5)
3. **4.4** - CBT Chat with AI (Premium differentiator, 4 SP)

**Template Reference:** Use story-2-2 for AI, story-5-1 for cross-module patterns

**Key Focus Areas:**
- Mood/stress tracking UI (always accessible, no paywall)
- Cross-module API design (mood/stress ‚Üí Life Coach + Fitness)
- CBT chat (1/day free, unlimited premium)
- Therapeutic conversation patterns

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-4.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\story-4-5-detailed-context.md

---

#### Batch 7: Epic 4 - Mind & Emotion Meditation (MEDIUM Priority)
**Stories:** 4.1, 4.2, 4.6
**Estimated Tokens:** ~9,500 (3,000 + 3,500 + 3,000)
**Session Duration:** 60-90 minutes
**Dependencies:** Batch 6 (mood tracking for recommendations)

**Stories:**
1. **4.1** - Guided Meditation Library (20-30 MVP meditations)
2. **4.2** - Meditation Player with Breathing Animation (3 SP)
3. **4.6** - Mental Health Screening (GAD-7, PHQ-9, 3 SP)

**Template Reference:** Use story-4-5 for data privacy considerations

**Key Focus Areas:**
- Meditation library (categories, durations, difficulty levels)
- Audio player (background playback, breathing animation)
- Mental health screening (GAD-7, PHQ-9, crisis resources)

---

#### Batch 8: Epic 5 - Cross-Module Intelligence (HIGH Priority - Killer Feature!)
**Stories:** 5.2, 5.3, 5.4
**Estimated Tokens:** ~8,500 (3,500 + 2,500 + 2,500)
**Session Duration:** 60-90 minutes
**Dependencies:** Batches 2, 4, 6 (all modules required)

**Stories:**
1. **5.2** - Insight Card UI (Swipeable, actionable)
2. **5.3** - High Stress + Heavy Workout ‚Üí Suggest Light Session
3. **5.4** - Poor Sleep + Morning Workout ‚Üí Suggest Afternoon

**Template Reference:** Use story-5-1 (Insight Engine) as primary reference

**Key Focus Areas:**
- Insight card design (swipeable, actionable CTAs)
- Pattern detection logic (stress + workout intensity)
- Scheduling optimization (sleep quality + workout timing)
- Max 1 insight/day to prevent notification fatigue

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-5.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\story-5-1-detailed-context.md

---

#### Batch 9: Epic 6 - Gamification (MEDIUM Priority)
**Stories:** 6.1, 6.2, 6.6
**Estimated Tokens:** ~10,500 (3,500 + 3,500 + 3,500)
**Session Duration:** 90-120 minutes
**Dependencies:** Batches 2, 4, 6 (all activity types required)

**Stories:**
1. **6.1** - Streak Tracking System (Workouts, Meditations, Check-ins)
2. **6.2** - Milestone Badges (Bronze, Silver, Gold)
3. **6.6** - Weekly Summary Report (All modules)

**Template Reference:** Use story-2-2 for weekly report generation

**Key Focus Areas:**
- Streak logic (freeze mechanics, weekly reset)
- Badge system (bronze/silver/gold milestones)
- Weekly report (aggregated stats across all modules)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-6.md

---

### TRACK C: Onboarding + Notifications + Settings (Batches 10-12)
**Priority:** MEDIUM - Important for user acquisition and retention

---

#### Batch 10: Epic 7 - Onboarding & Subscriptions (MEDIUM Priority)
**Stories:** 7.1, 7.4, 7.5
**Estimated Tokens:** ~9,000 (3,000 + 3,000 + 3,000)
**Session Duration:** 60-90 minutes
**Dependencies:** Batch 1 (auth required)

**Stories:**
1. **7.1** - Onboarding Flow - Choose Your Journey
2. **7.4** - Free Tier (Life Coach Basic)
3. **7.5** - 14-Day Trial (All Premium Features)

**Template Reference:** Use story-7-6 (Subscription Management) as primary reference

**Key Focus Areas:**
- Onboarding UX (module selection, goal setting)
- Free tier limitations (3 goals, 5 AI plans/day, 1 CBT chat/day)
- Trial activation (14-day countdown, upgrade prompts)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-7.md
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\story-7-6-detailed-context.md

---

#### Batch 11: Epic 8 - Notifications (MEDIUM Priority)
**Stories:** 8.1, 8.2, 8.4
**Estimated Tokens:** ~9,000 (3,000 + 2,500 + 3,500)
**Session Duration:** 60-90 minutes
**Dependencies:** Batches 2, 4, 6, 8 (all modules + insights required)

**Stories:**
1. **8.1** - Push Notification Infrastructure (FCM setup)
2. **8.2** - Daily Reminders (Morning check-in, workout, meditation)
3. **8.4** - Cross-Module Insight Notifications (Max 1/day)

**Template Reference:** Use story-5-1 for cross-module notification logic

**Key Focus Areas:**
- FCM integration (iOS + Android)
- Notification scheduling (quiet hours: 10pm-7am)
- Insight notification (max 1/day, actionable)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-8.md

---

#### Batch 12: Epic 9 - Settings & Profile (MEDIUM Priority)
**Stories:** 9.1, 9.2, 9.5
**Estimated Tokens:** ~9,000 (3,000 + 2,500 + 3,500)
**Session Duration:** 60-90 minutes
**Dependencies:** Batches 1, 10 (auth + subscriptions required)

**Stories:**
1. **9.1** - Personal Settings (Name, email, password, avatar)
2. **9.2** - Notification Preferences (Per-module toggles)
3. **9.5** - Data Privacy & Cross-Module Settings (GDPR toggles)

**Template Reference:** Use story-1-6 for GDPR patterns

**Key Focus Areas:**
- Settings UI (grouped by category)
- Notification preferences (per-module, per-type)
- Data privacy controls (cross-module data sharing opt-in/out)

**Files to Read First:**
- C:\Users\Mariusz K\Documents\Programowanie\GymAPP\GymApp\docs\sprint-artifacts\tech-spec-epic-9.md

---

## LOW Priority Stories (Batch 13-15, Defer if Needed)

### Batch 13: Epic 1, 2, 3 - Polish Features
**Stories:** 1.3, 1.4, 2.6, 2.8, 2.10, 3.4, 3.9
**Estimated Tokens:** ~17,500 (2,500 √ó 7)
**Session Duration:** 120-150 minutes

### Batch 14: Epic 4 - Mind Enhancements
**Stories:** 4.7, 4.8, 4.9, 4.10, 4.11, 4.13, 4.14
**Estimated Tokens:** ~14,000 (2,000 √ó 7)
**Session Duration:** 90-120 minutes

### Batch 15: Epic 5, 6, 7, 8, 9 - Nice-to-Have Features
**Stories:** 3.10, 5.5, 6.3, 6.4, 6.5, 7.2, 7.3, 7.7, 8.3, 8.5, 9.3, 9.4
**Estimated Tokens:** ~24,000 (2,000 √ó 12)
**Session Duration:** 150-180 minutes (split into 2 sessions)

---

## Batch Execution Strategy

### Parallel Execution Recommendation

**Week 1-2: Foundation**
- Track A, Batch 1 (Epic 1) - **Critical blocker, must finish first**
- Track B can start Batch 6 (Epic 4 core) in parallel

**Week 3-4: Core Features**
- Track A, Batch 2 (Epic 2 core AI)
- Track A, Batch 4 (Epic 3 foundation)
- Track B, Batch 7 (Epic 4 meditation)

**Week 5-6: Advanced Features**
- Track A, Batch 3 (Epic 2 supporting)
- Track A, Batch 5 (Epic 3 progress)
- Track B, Batch 8 (Epic 5 - killer feature!)
- Track B, Batch 9 (Epic 6 gamification)

**Week 7-8: User Acquisition & Retention**
- Track C, Batch 10 (Epic 7 onboarding)
- Track C, Batch 11 (Epic 8 notifications)
- Track C, Batch 12 (Epic 9 settings)

**Week 9-10: Polish (if time permits)**
- Batches 13-15 (LOW priority stories)

---

## Quality Checklist (Per Batch)

Before submitting each batch, ensure:

### Structure
- [ ] Uses story-2-2-detailed-context.md template structure
- [ ] Includes all standard sections (Executive Summary, Architecture, Implementation, Testing, etc.)
- [ ] Follows consistent formatting (headings, code blocks, diagrams)

### Technical Depth
- [ ] System architecture diagram (ASCII art)
- [ ] Detailed implementation code snippets (Dart + Riverpod)
- [ ] Database schema (Drift + Supabase)
- [ ] API contracts (if applicable)

### Testing
- [ ] Unit test examples
- [ ] Integration test scenarios
- [ ] Performance benchmarks (if applicable)

### Cross-References
- [ ] Links to related stories (dependencies)
- [ ] References to epic tech specs
- [ ] References to existing implementation files (if available)

### Completeness
- [ ] Definition of Done checklist
- [ ] Non-functional requirements (NFRs)
- [ ] Risk assessment
- [ ] Performance optimization strategies

---

## Token Budget Summary

| Batch | Stories | Est. Tokens | Priority | Track |
|-------|---------|-------------|----------|-------|
| Batch 1 | 4 (Epic 1) | 12,000 | HIGH | A |
| Batch 2 | 3 (Epic 2) | 10,000 | HIGH | A |
| Batch 3 | 3 (Epic 2) | 8,500 | MEDIUM | A |
| Batch 4 | 3 (Epic 3) | 10,000 | HIGH | A |
| Batch 5 | 3 (Epic 3) | 8,500 | MEDIUM | A |
| Batch 6 | 3 (Epic 4) | 10,500 | HIGH | B |
| Batch 7 | 3 (Epic 4) | 9,500 | MEDIUM | B |
| Batch 8 | 3 (Epic 5) | 8,500 | HIGH | B |
| Batch 9 | 3 (Epic 6) | 10,500 | MEDIUM | B |
| Batch 10 | 3 (Epic 7) | 9,000 | MEDIUM | C |
| Batch 11 | 3 (Epic 8) | 9,000 | MEDIUM | C |
| Batch 12 | 3 (Epic 9) | 9,000 | MEDIUM | C |
| **SUBTOTAL** | **37** | **~115,000** | **HIGH/MED** | **A+B+C** |
| Batch 13 | 7 (Polish) | 17,500 | LOW | - |
| Batch 14 | 7 (Mind+) | 14,000 | LOW | - |
| Batch 15 | 12 (Nice) | 24,000 | LOW | - |
| **TOTAL** | **60** | **~170,500** | **ALL** | **ALL** |

---

## Next Steps

1. **Review this plan** with team/stakeholders
2. **Confirm priority order** (adjust if business needs changed)
3. **Begin Batch 1** (Epic 1 - Core Platform Foundation)
4. **Track progress** in STORY_CONTEXT_INVENTORY.md
5. **Adjust estimates** after first 2-3 batches (refine token usage)

---

**Document Status:** Ready for Execution
**Estimated Completion:** 8-10 weeks (with parallel tracks)
**Risk Level:** Low (well-structured, token-efficient)
